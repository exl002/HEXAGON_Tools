/*****************************************************************
# Copyright (c) $Date$ QUALCOMM INCORPORATED.
# All Rights Reserved.
# Modified by QUALCOMM INCORPORATED on $Date$
*****************************************************************/
#include <stdio.h>
#include <string.h>
#include <hexagon_sim_timer.h>


short int Input1[] __attribute__((aligned(8))) =
{
  0x6b8b,0x643c,0x74b0,0x2ae8,0x238e,0x3d1b,0x2eb1,0x79e2,0x515f,0x1220,0x0216,0x1190,0x140e,0x109c,0x7fdc,0x41a7,
  0x4e6a,0x519b,0x3f2d,0x2571,0x436c,0x333a,0x2443,0x6763,0x08ed,0x4353,0x189a,0x71f3,0x0836,0x3a95,0x1e7f,0x737b,
  0x2222,0x3006,0x419a,0x440b,0x3804,0x7724,0x2463,0x51ea,0x580b,0x3855,0x6a23,0x1d4e,0x2cd8,0x7a6d,0x5422,0x3843,
  0x32ff,0x5794,0x3dc2,0x79a1,0x12e6,0x520e,0x4f4e,0x649b,0x3938,0x1801,0x4739,0x15b5,0x0d34,0x3f6a,0x7e0c,0x579b,
  0x5ff8,0x25a7,0x4ad0,0x1381,0x100f,0x1501,0x098a,0x06b9,0x168e,0x661e,0x540a,0x51d9,0x0bf7,0x4296,0x08f2,0x3b0f,
  0x4962,0x06a5,0x7fff,0x71ea,0x7fb7,0x6f6d,0x0088,0x4c04,0x14e1,0x74de,0x2df6,0x4a2a,0x57fc,0x43f1,0x26f3,0x49da,
  0x5fb8,0x0488,0x6aa7,0x6fc7,0x7d5e,0x73a1,0x555c,0x14fc,0x71c9,0x5329,0x5092,0x59ad,0x2a15,0x097e,0x1ca0,0x415e,
  0x23d8,0x5c10,0x3c59,0x78df,0x2b0d,0x379e,0x2c27,0x6aa7,0x5675,0x3db0,0x5b25,0x4f97,0x34fd,0x5643,0x2c6e,0x4df7
};

short int Input2[] __attribute__((aligned(8))) =
{
  0x327b,0x6633,0x1949,0x6255,0x46e8,0x507e,0x41b7,0x7545,0x5bd0,0x4db1,0x1f16,0x66ef,0x3352,0x0ded,0x1bef,0x6b68,
  0x25e4,0x431b,0x7c83,0x62bb,0x628c,0x721d,0x2d1d,0x75a2,0x7983,0x0b03,0x54e4,0x2ca8,0x0290,0x0813,0x7c3d,0x6cea,
  0x4516,0x614f,0x5577,0x0507,0x7746,0x5c48,0x5e88,0x2d51,0x153e,0x70a6,0x2a48,0x725a,0x57e4,0x4b58,0x6de9,0x7644,
  0x684a,0x749a,0x1ba0,0x75c6,0x70c6,0x374a,0x23f9,0x275a,0x1cf1,0x235b,0x354f,0x7412,0x1023,0x6157,0x77ae,0x310c,
  0x2f30,0x1dba,0x1f48,0x5db7,0x6590,0x5f5e,0x799d,0x42c2,0x1eba,0x5dc7,0x7bd3,0x613e,0x1144,0x0a03,0x1a32,0x68eb,
  0x60b6,0x1433,0x1a27,0x100f,0x06eb,0x0942,0x7627,0x1716,0x3222,0x68eb,0x46b7,0x39ee,0x0cc1,0x60ef,0x7f01,0x7055,
  0x5080,0x5fb8,0x7672,0x6a5f,0x5f35,0x7de6,0x3fa6,0x6a3d,0x09da,0x1fbf,0x1d54,0x288f,0x1d9f,0x5108,0x5358,0x7c58,
  0x45e6,0x0e7f,0x4bd8,0x39b7,0x6c80,0x0069,0x4c9b,0x1df0,0x3dd1,0x2708,0x175d,0x053b,0x5915,0x519e,0x17a1,0x5046
};

short int Expected_results[] __attribute__((aligned(8))) =
{
  0x9e06,0xca6f,0x8df9,0x8d3d,0x6a76,0x8d99,0x7068,0xef27,0xad2f,0x5fd1,0x212c,0x787f,0x4760,0x1e89,0x9bcb,0xad0f,
  0x744e,0x94b6,0xbbb0,0x882c,0xa5f8,0xa557,0x5160,0xdd05,0x8270,0x4e56,0x6d7e,0x9e9b,0x0ac6,0x42a8,0x9abc,0xe065,
  0x6738,0x9155,0x9711,0x4912,0xaf4a,0xd36c,0x82eb,0x7f3b,0x6d49,0xa8fb,0x946b,0x8fa8,0x84bc,0xc5c5,0xc20b,0xae87,
  0x9b49,0xcc2e,0x5962,0xef67,0x83ac,0x8958,0x7347,0x8bf5,0x5629,0x3b5c,0x7c88,0x89c7,0x1d57,0xa0c1,0xf5ba,0x88a7,
  0x8f28,0x4361,0x6a18,0x7138,0x759f,0x745f,0x8327,0x497b,0x3548,0xc3e5,0xcfdd,0xb317,0x1d3b,0x4c99,0x2324,0xa3fa,
  0xaa18,0x1ad8,0x9a26,0x81f9,0x86a2,0x78af,0x76af,0x631a,0x4703,0xddc9,0x74ad,0x8418,0x64bd,0xa4e0,0xa5f4,0xba2f,
  0xb038,0x6440,0xe119,0xda26,0xdc93,0xf187,0x9502,0x7f39,0x7ba3,0x72e8,0x6de6,0x823c,0x47b4,0x5a86,0x6ff8,0xbdb6,
  0x69be,0x6a8f,0x8831,0xb296,0x978d,0x3807,0x78c2,0x8897,0x9446,0x64b8,0x7282,0x54d2,0x8e12,0xa7e1,0x440f,0x9e3d
};

#define OUTPUT_SIZE (sizeof(Expected_results) / sizeof(short int))
short int Output[OUTPUT_SIZE]  __attribute__((aligned(8)));



extern void VecADD(short int *In1, short int *In2, short int *Out, int samples);




typedef void (*VecADD_fptr)(short int*, short int*, short int*, int);

#define REGISTER_VecADD_VERSION(function) extern void function (short int *In1, short int *In2, short int *Out, int samples);

#define VecADD_VERSION(function, desc) { #desc , function }

REGISTER_VecADD_VERSION(VecADD_orig);
REGISTER_VecADD_VERSION(VecADD_restrict);

struct VecADD_version
{
  char *desc;
  VecADD_fptr function;
};

struct VecADD_version funcs[] =
  {
    VecADD_VERSION(VecADD_orig, "Without restrict"),
    VecADD_VERSION(VecADD_restrict, "With restrict"),
  };

#define FUNC_COUNT sizeof(funcs) / sizeof(struct VecADD_version)


unsigned long long times[FUNC_COUNT];

int
main()
{
  int i, index;
  unsigned long long start, stop;
    
  printf("Index\t%40s\tStatus\tCycles\tChange\n", "Name");

  for (index = 0 ; index < FUNC_COUNT ; index++) {
    int passed;
    passed = 1;
    memset(Output, 0x0, sizeof(Output[0]) * OUTPUT_SIZE);
    
    start = hexagon_sim_read_cycles();
    funcs[index].function(Input1, Input2, Output, OUTPUT_SIZE);
    stop = hexagon_sim_read_cycles();

    times[index] = stop - start;

    for (i=0;i<OUTPUT_SIZE;i++) {
      if (Output[i]!=Expected_results[i]) {
        printf("FAILED!!!\n");
        printf("Output[%d] = %x\n", i, Output[i]);
        printf("Expected[%d] = %x\n", i, Expected_results[i]);
        passed = 0;
        return -1;
      }
    }

    printf("%d\t%40s\t%s\t%6llu\t%5.2f%%\n",
           index,
           funcs[index].desc,
           (passed ? "PASSED" : "FAILED"),
           times[index],
           (index > 0) ? (((double) times[0] - (double)times[index]) / (double)times[0] * 100.0) : 0.0);
  }

  return 0;
}
