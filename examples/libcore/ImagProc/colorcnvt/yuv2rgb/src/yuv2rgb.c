/***************************************************************************
* Copyright (c) Date: Mon Nov 24 16:26:03 CST 2008 QUALCOMM INCORPORATED 
* All Rights Reserved 
* Modified by QUALCOMM INCORPORATED on Mon Nov 24 16:26:03 CST 2008 
****************************************************************************/ 


#include <stdio.h>
#include "typedef.h"

#define  satub(x)           ((x) >255 ? 255:(x) < 0 ? 0:(x))

/*
 *------------------------------------------------------*
 *  Eric Plondke's approximate implmentation            *
 *                                                      *
 *  B = 1.164(Y-16)                + 2.018(U-128)       *
 *  G = 1.164(Y-16) - 0.813(V-128) - 0.391(U-128)       *
 *  R = 1.164(Y-16) + 1.596(V-128)                      *
 *------------------------------------------------------*
 *                                                      *
 * Look-up table is generated as                        *
 *                                                      *
 *  void genYUV2RGBtab()                                *
 *  {                                                   *
 *      int i,uvi,yi;                                   *
 *      for (i = 0; i < 256; i++) {                     *
 *             uvi = i-128;                             *
 *             uvi = (uvi < -112)?-112:uvi;             *
 *             uvi = (uvi >  112)? 112:uvi;             *
 *             yi = i-16;                               *
 *             yi = (yi < 0) ? 0 : yi;                  *
 *             LUT_yuv2rgb[i] = (uvi*8/10);             *
 *      }                                               *
 *  }                                                   *
 *------------------------------------------------------*
*/

Word8  LUT_yuv2rgb[256] = {
    -89,-89,-89,-89,-89,-89,-89,-89,
    -89,-89,-89,-89,-89,-89,-89,-89,
    -89,-88,-88,-87,-86,-85,-84,-84,
    -83,-82,-81,-80,-80,-79,-78,-77,
    -76,-76,-75,-74,-73,-72,-72,-71,
    -70,-69,-68,-68,-67,-66,-65,-64,
    -64,-63,-62,-61,-60,-60,-59,-58,
    -57,-56,-56,-55,-54,-53,-52,-52,
    -51,-50,-49,-48,-48,-47,-46,-45,
    -44,-44,-43,-42,-41,-40,-40,-39,
    -38,-37,-36,-36,-35,-34,-33,-32,
    -32,-31,-30,-29,-28,-28,-27,-26,
    -25,-24,-24,-23,-22,-21,-20,-20,
    -19,-18,-17,-16,-16,-15,-14,-13,
    -12,-12,-11,-10,-9,-8,-8,-7,
    -6,-5,-4,-4,-3,-2,-1,0,
    0,0,1,2,3,4,4,5,
    6,7,8,8,9,10,11,12,
    12,13,14,15,16,16,17,18,
    19,20,20,21,22,23,24,24,
    25,26,27,28,28,29,30,31,
    32,32,33,34,35,36,36,37,
    38,39,40,40,41,42,43,44,
    44,45,46,47,48,48,49,50,
    51,52,52,53,54,55,56,56,
    57,58,59,60,60,61,62,63,
    64,64,65,66,67,68,68,69,
    70,71,72,72,73,74,75,76,
    76,77,78,79,80,80,81,82,
    83,84,84,85,86,87,88,88,
    89,89,89,89,89,89,89,89,
    89,89,89,89,89,89,89,89
};



void YUVConvert( UWord8 *in, int width, int height, UWord8 *out) {
  Word32 y,u,v, ug, vg, ruv, guv, buv;
  const UWord8 *ybuf = in;
  const UWord8 *uvbuf = in+(width*height);

  int i,j;

  for (i = 0; i < height; i++) {
      for (j = 0; j < width; j+=2) {
          v = *uvbuf++;
          u = *uvbuf++;
          ug = LUT_yuv2rgb[u]>>1;
          vg = LUT_yuv2rgb[v];
          buv = u + u - 256;
          guv = -ug - vg;
          ruv = vg+vg;

          y = *ybuf++;
          *out++ = satub(y+ruv);    // r
          *out++ = satub(y+guv);    // g
          *out++ = satub(y+buv);    // b

          y = *ybuf++;       
          *out++ = satub(y+ruv);    // r
          *out++ = satub(y+guv);    // g
          *out++ = satub(y+buv);    // b
      }
      if ((i & 1) == 0) 
         uvbuf -= width;
  }
}

