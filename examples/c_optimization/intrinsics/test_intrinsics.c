/*****************************************************************
# Copyright (c) $Date$ QUALCOMM INCORPORATED.
# All Rights Reserved.
# Modified by QUALCOMM INCORPORATED on $Date$
*****************************************************************/
#include <stdio.h>
#include <string.h>
#include <hexagon_sim_timer.h>

short int Input1[] __attribute__((aligned(8))) =
{
  0x6b8b,0x643c,0x74b0,0x2ae8,0x238e,0x3d1b,0x2eb1,0x79e2,0x515f,0x1220,0x0216,0x1190,0x140e,0x109c,0x7fdc,0x41a7,
  0x4e6a,0x519b,0x3f2d,0x2571,0x436c,0x333a,0x2443,0x6763,0x08ed,0x4353,0x189a,0x71f3,0x0836,0x3a95,0x1e7f,0x737b,
  0x2222,0x3006,0x419a,0x440b,0x3804,0x7724,0x2463,0x51ea,0x580b,0x3855,0x6a23,0x1d4e,0x2cd8,0x7a6d,0x5422,0x3843,
  0x32ff,0x5794,0x3dc2,0x79a1,0x12e6,0x520e,0x4f4e,0x649b,0x3938,0x1801,0x4739,0x15b5,0x0d34,0x3f6a,0x7e0c,0x579b,
  0x5ff8,0x25a7,0x4ad0,0x1381,0x100f,0x1501,0x098a,0x06b9,0x168e,0x661e,0x540a,0x51d9,0x0bf7,0x4296,0x08f2,0x3b0f,
  0x4962,0x06a5,0x7fff,0x71ea,0x7fb7,0x6f6d,0x0088,0x4c04,0x14e1,0x74de,0x2df6,0x4a2a,0x57fc,0x43f1,0x26f3,0x49da,
  0x5fb8,0x0488,0x6aa7,0x6fc7,0x7d5e,0x73a1,0x555c,0x14fc,0x71c9,0x5329,0x5092,0x59ad,0x2a15,0x097e,0x1ca0,0x415e,
  0x23d8,0x5c10,0x3c59,0x78df,0x2b0d,0x379e,0x2c27,0x6aa7,0x5675,0x3db0,0x5b25,0x4f97,0x34fd,0x5643,0x2c6e,0x4df7
};

short int Input2[] __attribute__((aligned(8))) =
{
  0x327b,0x6633,0x1949,0x6255,0x46e8,0x507e,0x41b7,0x7545,0x5bd0,0x4db1,0x1f16,0x66ef,0x3352,0x0ded,0x1bef,0x6b68,
  0x25e4,0x431b,0x7c83,0x62bb,0x628c,0x721d,0x2d1d,0x75a2,0x7983,0x0b03,0x54e4,0x2ca8,0x0290,0x0813,0x7c3d,0x6cea,
  0x4516,0x614f,0x5577,0x0507,0x7746,0x5c48,0x5e88,0x2d51,0x153e,0x70a6,0x2a48,0x725a,0x57e4,0x4b58,0x6de9,0x7644,
  0x684a,0x749a,0x1ba0,0x75c6,0x70c6,0x374a,0x23f9,0x275a,0x1cf1,0x235b,0x354f,0x7412,0x1023,0x6157,0x77ae,0x310c,
  0x2f30,0x1dba,0x1f48,0x5db7,0x6590,0x5f5e,0x799d,0x42c2,0x1eba,0x5dc7,0x7bd3,0x613e,0x1144,0x0a03,0x1a32,0x68eb,
  0x60b6,0x1433,0x1a27,0x100f,0x06eb,0x0942,0x7627,0x1716,0x3222,0x68eb,0x46b7,0x39ee,0x0cc1,0x60ef,0x7f01,0x7055,
  0x5080,0x5fb8,0x7672,0x6a5f,0x5f35,0x7de6,0x3fa6,0x6a3d,0x09da,0x1fbf,0x1d54,0x288f,0x1d9f,0x5108,0x5358,0x7c58,
  0x45e6,0x0e7f,0x4bd8,0x39b7,0x6c80,0x0069,0x4c9b,0x1df0,0x3dd1,0x2708,0x175d,0x053b,0x5915,0x519e,0x17a1,0x5046
};

#define INPUT_SIZE (sizeof(Input) / sizeof(short int))

int Expected_results[] __attribute__((aligned(8))) =
{
  0xed30f1d5, 0x3eb2af85, 0xfb0b6728, 0x310f0298, 0xf6a28966, 0x1c1aa25c, 0xd4272d9d, 0x34acfd43, 
  0x17aeba10, 0x1f31efaf, 0xf9311274, 0x02f8a8ea, 0x031dea10, 0x046bacee, 0xf268198c, 0x3ccecd49, 
  0xf636fc0f, 0x20a2183a, 0x1049847c, 0x2a9344b2, 0x031e957e, 0x31c5f2f4, 0xd6e236f1, 0x22e1ae9d, 
  0x01573b4e, 0x2056f840, 0xf447e5b0, 0x2a13d57c, 0xfe3c0951, 0x00d869d2, 0xddab55d5, 0x45048c65, 
  0xf6f50112, 0x19ef2902, 0x14908d49, 0x18011553, 0xef26baf8, 0x4bb380f8, 0xfeefa18e, 0x24b05aa3, 
  0xee84828c, 0x2b6a84b8, 0x04708e6c, 0x343ff03e, 0xeb5d53e8, 0x373ac654, 0x0a213926, 0x3f05c103, 
  0xece296ae, 0x3ae7aa2e, 0xceb567ba, 0x29896dac, 0xf69a83d8, 0x283a7750, 0xfbadd160, 0x1a53cf2f, 
  0x0327525d, 0x0a9db3d9, 0x04fd3cdd, 0x24d001dd, 0xe8b85716, 0x09047c2a, 0x2a2479e4, 0x411accea
};

#define OUTPUT_SIZE (sizeof(Expected_results) / sizeof(int))

int Output[OUTPUT_SIZE]  __attribute__((aligned(8)));

typedef void (*cmpy_fptr)(short int*, short int*, int*, int);

#define REGISTER_cmpy_VERSION(function) extern void function (short int *In1, short int *In2, int *Out, int samples);

#define cmpy_VERSION(function, desc) { #desc , function }

REGISTER_cmpy_VERSION(cmpy_orig);
REGISTER_cmpy_VERSION(cmpy_intrinsic);

struct cmpy_version
{
  char *desc;
  cmpy_fptr function;
};

struct cmpy_version funcs[] =
  {
    cmpy_VERSION(cmpy_orig, "Complex multiply without intrinsic"),
    cmpy_VERSION(cmpy_intrinsic, "Complex multiply with intrinsic")
  };

#define FUNC_COUNT sizeof(funcs) / sizeof(struct cmpy_version)

unsigned long long times[FUNC_COUNT];

int
main()
{
  int i, index;
  unsigned long long start, stop;
    
  printf("Index\t%40s\tStatus\tCycles\tChange\n", "Name");
  for (index = 0 ; index < FUNC_COUNT ; index++) {
    int passed;
    passed = 1;
    
    start = hexagon_sim_read_cycles();
    funcs[index].function(Input1, Input2, Output, OUTPUT_SIZE);
    stop = hexagon_sim_read_cycles();

    times[index] = stop - start;

    for (i=0;i<OUTPUT_SIZE;i++) {
      if (Output[i]!=Expected_results[i]) {
        printf("FAILED!!!\n");
        printf("Output[%d] = %x\n", i, Output[i]);
        printf("Expected[%d] = %x\n", i, Expected_results[i]);
        passed = 0;
        return -1;
      }
    }

    printf("%d\t%40s\t%s\t%6llu\t%5.2f%%\n",
           index,
           funcs[index].desc,
           (passed ? "PASSED" : "FAILED"),
           times[index],
           (index > 0) ? (((double) times[0] - (double)times[index]) / (double)times[0] * 100.0) : 0.0);
  }

  return 0;
}